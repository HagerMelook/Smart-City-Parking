-- MySQL Script generated by MySQL Workbench
-- Sat Dec 28 00:12:22 2024
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema parking
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema parking
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `parking` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `parking` ;

-- -----------------------------------------------------
-- Table `parking`.`user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`user` (
  `user_id` INT NOT NULL AUTO_INCREMENT,
  `type` VARCHAR(80) NOT NULL,
  PRIMARY KEY (`user_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`driver`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`driver` (
  `driver_id` INT NOT NULL,
  `full_name` VARCHAR(80) NOT NULL,
  `email` VARCHAR(80) NOT NULL,
  `password` VARCHAR(80) NOT NULL,
  `license_plate` VARCHAR(20) NOT NULL,
  `card_type` VARCHAR(50) NOT NULL,
  `card_number` INT NOT NULL,
  `expiry_date` DATE NOT NULL,
  `cvv` INT NOT NULL,
  PRIMARY KEY (`driver_id`),
  UNIQUE INDEX `email` (`email` ASC) VISIBLE,
  UNIQUE INDEX `license_plate` (`license_plate` ASC) VISIBLE,
  UNIQUE INDEX `card_number` (`card_number` ASC) VISIBLE,
  CONSTRAINT `driver_ibfk_1`
    FOREIGN KEY (`driver_id`)
    REFERENCES `parking`.`user` (`user_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`parking_lots`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`parking_lots` (
  `lot_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(80) NOT NULL,
  `location` POINT NOT NULL,
  `capacity` INT NULL DEFAULT '0',
  `regular_cap` INT NULL DEFAULT '0',
  `disabled_cap` INT NULL DEFAULT '0',
  `ev_charging_cap` INT NULL DEFAULT '0',
  PRIMARY KEY (`lot_id`),
  UNIQUE INDEX `name` (`name` ASC) VISIBLE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`lot_admin`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`lot_admin` (
  `lot_admin_id` INT NOT NULL,
  `full_name` VARCHAR(80) NOT NULL,
  `email` VARCHAR(80) NOT NULL,
  `password` VARCHAR(80) NOT NULL,
  `lot_id` INT NULL DEFAULT NULL,
  PRIMARY KEY (`lot_admin_id`),
  UNIQUE INDEX `email` (`email` ASC) VISIBLE,
  INDEX `lot_id` (`lot_id` ASC) VISIBLE,
  CONSTRAINT `lot_admin_ibfk_1`
    FOREIGN KEY (`lot_id`)
    REFERENCES `parking`.`parking_lots` (`lot_id`),
  CONSTRAINT `lot_admin_ibfk_2`
    FOREIGN KEY (`lot_admin_id`)
    REFERENCES `parking`.`user` (`user_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`notification`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`notification` (
  `notification_id` INT NOT NULL AUTO_INCREMENT,
  `user_id` INT NOT NULL,
  `type` VARCHAR(50) NULL DEFAULT NULL,
  `msg` VARCHAR(200) NULL DEFAULT NULL,
  `time` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`notification_id`),
  INDEX `user_id` (`user_id` ASC) VISIBLE,
  CONSTRAINT `notification_ibfk_1`
    FOREIGN KEY (`user_id`)
    REFERENCES `parking`.`user` (`user_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`parking_spots`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`parking_spots` (
  `spot_id` INT NOT NULL AUTO_INCREMENT,
  `lot_id` INT NOT NULL,
  `status` ENUM('available', 'occupied', 'reserved') NULL DEFAULT 'available',
  `type` ENUM('regular', 'disabled', 'ev_charging') NULL DEFAULT NULL,
  `price` DECIMAL(10,2) NULL DEFAULT '0.00',
  PRIMARY KEY (`spot_id`),
  INDEX `lot_id` (`lot_id` ASC) VISIBLE,
  CONSTRAINT `parking_spots_ibfk_1`
    FOREIGN KEY (`lot_id`)
    REFERENCES `parking`.`parking_lots` (`lot_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`reservations`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`reservations` (
  `resv_id` INT NOT NULL AUTO_INCREMENT,
  `driver_id` INT NOT NULL,
  `spot_id` INT NOT NULL,
  `start_time` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `end_time` TIMESTAMP NULL DEFAULT NULL,
  `status` ENUM('active', 'confirmed', 'expired', 'cancelled') NULL DEFAULT 'active',
  `penalty` DECIMAL(10,2) NULL DEFAULT '0.00',
  PRIMARY KEY (`resv_id`),
  INDEX `driver_id` (`driver_id` ASC) VISIBLE,
  INDEX `spot_id` (`spot_id` ASC) VISIBLE,
  CONSTRAINT `reservations_ibfk_1`
    FOREIGN KEY (`driver_id`)
    REFERENCES `parking`.`driver` (`driver_id`),
  CONSTRAINT `reservations_ibfk_2`
    FOREIGN KEY (`spot_id`)
    REFERENCES `parking`.`parking_spots` (`spot_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`sys_admin`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`sys_admin` (
  `sys_admin_id` INT NOT NULL AUTO_INCREMENT,
  `full_name` VARCHAR(80) NOT NULL,
  `email` VARCHAR(80) NOT NULL,
  `password` VARCHAR(80) NOT NULL,
  PRIMARY KEY (`sys_admin_id`),
  UNIQUE INDEX `email` (`email` ASC) VISIBLE,
  CONSTRAINT `sys_admin_ibfk_1`
    FOREIGN KEY (`sys_admin_id`)
    REFERENCES `parking`.`user` (`user_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`top_lots`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`top_lots` (
  `lot_id` INT NOT NULL,
  `revenue` DECIMAL(10,2) NULL DEFAULT '0.00',
  `is_top` TINYINT(1) NULL DEFAULT '0',
  PRIMARY KEY (`lot_id`),
  CONSTRAINT `top_lots_ibfk_1`
    FOREIGN KEY (`lot_id`)
    REFERENCES `parking`.`parking_lots` (`lot_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`top_users`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`top_users` (
  `driver_id` INT NOT NULL,
  `number_of_resvs` INT NULL DEFAULT '1',
  `is_top` TINYINT(1) NULL DEFAULT '0',
  PRIMARY KEY (`driver_id`),
  CONSTRAINT `top_users_ibfk_1`
    FOREIGN KEY (`driver_id`)
    REFERENCES `parking`.`driver` (`driver_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `parking`.`transactions`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `parking`.`transactions` (
  `transaction_id` INT NOT NULL AUTO_INCREMENT,
  `driver_id` INT NOT NULL,
  `amount` DECIMAL(10,2) NOT NULL,
  `timestamp` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `payment_status` ENUM('pending', 'completed') NULL DEFAULT 'pending',
  PRIMARY KEY (`transaction_id`),
  INDEX `driver_id` (`driver_id` ASC) VISIBLE,
  CONSTRAINT `transactions_ibfk_1`
    FOREIGN KEY (`driver_id`)
    REFERENCES `parking`.`driver` (`driver_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
